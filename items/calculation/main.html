	function updateGamessText() {
		var mol = viewer.getChemObj();
		var editor = document.getElementById('gamess-editor');
		if (!mol || mol.getNodeCount() === 0) {
			editor.value = "! No 3D coordinates available.\n! Please execute 'Generate 3D' in the Modeling pane.";
			return;
		}

		var theoryVal = document.getElementById('cfg-theory').value;
		var run = document.getElementById('cfg-run').value;
		var basisVal = document.getElementById('cfg-basis').value;
		var charge = document.getElementById('cfg-charge').value;
		var mult = document.getElementById('cfg-mult').value;

		var scftyp = (theoryVal.includes('B3LYP') || theoryVal === 'MP2') ? 'RHF' : theoryVal;
		if (mult > 1 && scftyp === 'RHF') scftyp = 'ROHF'; 

		var lines = [];
		var contrl = ` $CONTRL SCFTYP=${scftyp} RUNTYP=${run}`;
		if (charge !== "0") contrl += ` ICHARG=${charge}`;
		contrl += ` MULT=${mult}`;
		if (theoryVal.includes('B3LYP')) contrl += ` DFTTYP=B3LYP`;
		if (theoryVal === 'MP2') contrl += ` MPLEVL=2`;
		contrl += ` $END`;
		lines.push(contrl);

		var basisLine = "";
		switch(basisVal) {
			case 'STO': basisLine = " $BASIS GBASIS=STO NGAUSS=3 $END"; break;
			case 'N21': basisLine = " $BASIS GBASIS=N21 NGAUSS=3 $END"; break;
			case 'N31': basisLine = " $BASIS GBASIS=N31 NGAUSS=6 $END"; break;
			case 'N31-D': basisLine = " $BASIS GBASIS=N31 NGAUSS=6 NDFUNC=1 $END"; break;
			case 'N31-DP': basisLine = " $BASIS GBASIS=N31 NGAUSS=6 NDFUNC=1 NPFUNC=1 $END"; break;
			case 'N31-DP-DIFF': basisLine = " $BASIS GBASIS=N31 NGAUSS=6 NDFUNC=1 NPFUNC=1 DIFFSP=.TRUE. $END"; break;
		}
		lines.push(basisLine);

		if (run === 'HESSIAN' || run === 'SADPOINT') {
			lines.push(" $FORCE METHOD=ANALYTIC VIBANL=.TRUE. $END");
		}
		if (run === 'IRC') {
			lines.push(" $IRC SADDLE=.TRUE. FORWRD=.TRUE. NPOINT=100 STRIDE=0.1 $END");
		}
		if (run === 'OPTIMIZE') {
			lines.push(" $STATPT OPTTOL=0.0001 NSTEP=100 HSSEND=.TRUE. $END");
		}
		if (run === 'SADPOINT') {
			lines.push(" $STATPT OPTTOL=0.0001 NSTEP=100 HESS=CALC HSSEND=.TRUE. $END");
		}

		lines.push(' $DATA\nGAMESS Input generated by GfEditer (2026)\nC1');

		for (var i = 0; i < mol.getNodeCount(); ++i) {
			var node = mol.getNodeAt(i);
			if (node instanceof Kekule.Atom) {
				var coord = node.getAbsCoord3D() || node.getCoord3D();
				// 修正箇所：先頭のスペースを削除し、各項目の間隔を調整
				var symbol = node.getSymbol().padEnd(3);
				var atomNum = node.getAtomicNumber().toString().padStart(2) + ".0";
				var x = coord.x.toFixed(10).padStart(15);
				var y = coord.y.toFixed(10).padStart(15);
				var z = coord.z.toFixed(10).padStart(15);
				lines.push(`${symbol}${atomNum}${x}${y}${z}`);
			}
		}
		lines.push(' $END');
		editor.value = lines.join('\n');
	}
